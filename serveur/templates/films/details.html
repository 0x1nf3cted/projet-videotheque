{% extends "base.html" %}

{% block title %}{{ film.titre }}{% endblock %}

{% block content %}
<div class="film-details">
    <div class="film-header">
        {% if film.image %}
        <div class="film-poster-large {% if film.emprunt and film.emprunt.user_id %}emprunte{% endif %}">
            <img src="{{ api_url }}/api/images/{{ film.image }}" alt="{{ film.titre }}">
        </div>
        {% elif film.image_url %}
        <div class="film-poster-large {% if film.emprunt and film.emprunt.user_id %}emprunte{% endif %}">
            <img src="{{ film.image_url }}" alt="{{ film.titre }}">
        </div>
        {% endif %}
        <div class="film-header-info">
            <h1>{{ film.titre }}</h1>
            <div class="film-info">
        <p><strong>Réalisateur:</strong> {{ film.realisateur }}</p>
        <p><strong>Année:</strong> {{ film.annee }}</p>
        <p><strong>Genre:</strong> {{ film.genre }}</p>
        <p><strong>Format:</strong> {{ film.format }}</p>
        <p><strong>Durée:</strong> {{ film.duree }} minutes</p>
        <p><strong>Note:</strong> {{ film.note }}/10</p>
        {% if film.date_ajout %}
        <p><strong>Date d'ajout:</strong> {{ film.date_ajout[:10] }}</p>
        {% endif %}
        {% if film.emprunt and film.emprunt.user_id %}
        <p><strong>Status:</strong> <span style="color: #c33;">Emprunté</span></p>
        {% endif %}
            </div>
        </div>
    </div>
    
    {% if film.resume %}
    <div class="film-resume">
        <h3>Résumé</h3>
        <p>{{ film.resume }}</p>
    </div>
    {% endif %}
    
    {% if acteurs %}
    <div class="film-acteurs">
        <h3>Acteurs</h3>
        <div class="acteurs-grid">
            {% for acteur in acteurs %}
            <div class="acteur-card">
                {% if acteur.image_url %}
                <div class="acteur-photo">
                    <img src="{{ acteur.image_url }}" alt="{{ acteur.prenom }} {{ acteur.nom }}">
                </div>
                {% endif %}
                <div class="acteur-info">
                    <p><strong>{{ acteur.prenom }} {{ acteur.nom }}</strong></p>
                    {% if acteur.nationalite %}
                    <p class="acteur-nationalite">{{ acteur.nationalite }}</p>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    <div class="film-actions">
        {% if not film.emprunt or not film.emprunt.user_id %}
        <form method="POST" action="{{ url_for('emprunter_film', id=film.id) }}" style="display: inline;">
            <button type="submit" class="btn btn-primary">Emprunter</button>
        </form>
        {% endif %}
        {% if is_favorite %}
        <form method="POST" action="{{ url_for('supprimer_favori', id=film.id) }}" style="display: inline;">
            <button type="submit" class="btn btn-secondary">Retirer des favoris</button>
        </form>
        {% else %}
        <form method="POST" action="{{ url_for('ajouter_favori', id=film.id) }}" style="display: inline;">
            <button type="submit" class="btn btn-secondary">Ajouter aux favoris</button>
        </form>
        {% endif %}
        <a href="{{ url_for('modifier_film', id=film.id) }}">Modifier</a>
        <form method="POST" action="{{ url_for('supprimer_film', id=film.id) }}" style="display: inline;">
            <button type="submit" onclick="return confirm('Êtes-vous sûr de vouloir supprimer ce film ?')">Supprimer</button>
        </form>
        <a href="{{ url_for('liste_films') }}">Retour à la liste</a>
    </div>
    
    <div class="commentaires-section">
        <h3>Commenter ce film</h3>
        <form method="POST" action="{{ url_for('commenter_film', id=film.id) }}" class="comment-form">
            <div>
                <label for="note">Note (0-10):</label>
                <input type="number" id="note" name="note" min="0" max="10" step="0.5" required>
            </div>
            <div>
                <label for="commentaire">Commentaire:</label>
                <textarea id="commentaire" name="commentaire" rows="4" placeholder="Votre avis sur ce film..."></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Publier</button>
        </form>
    </div>
    
    <div class="commentaires-list">
        <h3>Commentaires ({{ commentaires|length }})</h3>
        {% if commentaires %}
        <div class="commentaires">
            {% for commentaire in commentaires %}
            <div class="commentaire">
                <div class="commentaire-header">
                    <strong>{{ commentaire.username }}</strong>
                    <span class="note">{{ commentaire.note }}/10</span>
                    <span class="date">{{ commentaire.date[:10] }}</span>
                </div>
                {% if commentaire.commentaire %}
                <p class="commentaire-text">{{ commentaire.commentaire }}</p>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p>Aucun commentaire pour ce film.</p>
        {% endif %}
    </div>
</div>
{% endblock %}

