{% extends "base.html" %}

{% block title %}{{ film.titre }}{% endblock %}

{% block content %}
<div class="film-details">
    <div class="film-header">
        {% if film.image %}
        <div class="film-poster-large {% if film.emprunt and film.emprunt.user_id %}emprunte{% endif %}">
            <img src="{{ api_url }}/api/images/{{ film.image }}" alt="{{ film.titre }}">
        </div>
        {% elif film.image_url %}
        <div class="film-poster-large {% if film.emprunt and film.emprunt.user_id %}emprunte{% endif %}">
            <img src="{{ film.image_url }}" alt="{{ film.titre }}">
        </div>
        {% endif %}
        <div class="film-header-info">
            <h1>{{ film.titre }}</h1>
            <div class="film-info">
        <p><strong>Réalisateur:</strong> {{ film.realisateur }}</p>
        <p><strong>Année:</strong> {{ film.annee }}</p>
        <p><strong>Genre:</strong> {{ film.genre }}</p>
        <p><strong>Format:</strong> {{ film.format }}</p>
        <p><strong>Durée:</strong> {{ film.duree }} minutes</p>
        <p><strong>Note:</strong> {{ film.note }}/10</p>
        {% if film.date_ajout %}
        <p><strong>Date d'ajout:</strong> {{ film.date_ajout[:10] }}</p>
        {% endif %}
        {% if film.emprunt and film.emprunt.user_id %}
        <p><strong>Status:</strong> <span style="color: #c33;">Emprunté</span></p>
        {% endif %}
            </div>
        </div>
    </div>
    
    {% if film.resume %}
    <div class="film-resume">
        <h3>Résumé</h3>
        <p>{{ film.resume }}</p>
    </div>
    {% endif %}
    
    {% if acteurs %}
    <div class="film-acteurs">
        <h3>Acteurs</h3>
        <div class="acteurs-grid">
            {% for acteur in acteurs %}
            <div class="acteur-card">
                {% if acteur.image_url %}
                <div class="acteur-photo">
                    <img src="{{ acteur.image_url }}" alt="{{ acteur.prenom }} {{ acteur.nom }}">
                </div>
                {% endif %}
                <div class="acteur-info">
                    <p><strong><a href="{{ url_for('films_acteur', id=acteur.id) }}">{{ acteur.prenom }} {{ acteur.nom }}</a></strong></p>
                    {% if acteur.nationalite %}
                    <p class="acteur-nationalite">{{ acteur.nationalite }}</p>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    {% if recommendations %}
    <div class="recommendations-section">
        <h3>Films recommandés</h3>
        <div class="films-grid">
            {% for rec in recommendations %}
            <div class="film-card">
                {% if rec.image %}
                <div class="film-poster {% if rec.emprunt and rec.emprunt.user_id %}emprunte{% endif %}">
                    <img src="{{ api_url }}/api/images/{{ rec.image }}" alt="{{ rec.titre }}" loading="lazy">
                </div>
                {% elif rec.image_url %}
                <div class="film-poster {% if rec.emprunt and rec.emprunt.user_id %}emprunte{% endif %}">
                    <img src="{{ rec.image_url }}" alt="{{ rec.titre }}" loading="lazy">
                </div>
                {% endif %}
                <h3><a href="{{ url_for('details_film', id=rec.id) }}">{{ rec.titre }}</a></h3>
                <p><strong>Réalisateur:</strong> {{ rec.realisateur }}</p>
                <p><strong>Année:</strong> {{ rec.annee }}</p>
                <p><strong>Genre:</strong> {{ rec.genre }}</p>
                <p><strong>Note:</strong> {{ rec.note }}/10</p>
                {% if rec.match_score %}
                <p class="match-score">Pertinence: {{ rec.match_score }}</p>
                {% endif %}
                <div class="film-actions">
                    <a href="{{ url_for('details_film', id=rec.id) }}" class="film-card-action" title="Voir les détails">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    <div class="film-actions">
        <div class="film-actions-primary">
            {% if not film.emprunt or not film.emprunt.user_id %}
            <form method="POST" action="{{ url_for('emprunter_film', id=film.id) }}">
                <button type="submit" class="btn btn-primary">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    Emprunter
                </button>
            </form>
            {% endif %}
            {% if is_favorite %}
            <form method="POST" action="{{ url_for('supprimer_favori', id=film.id) }}">
                <button type="submit" class="btn btn-secondary">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2">
                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                    </svg>
                    Retirer des favoris
                </button>
            </form>
            {% else %}
            <form method="POST" action="{{ url_for('ajouter_favori', id=film.id) }}">
                <button type="submit" class="btn btn-secondary">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                    </svg>
                    Ajouter aux favoris
                </button>
            </form>
            {% endif %}
        </div>
        <div class="film-actions-secondary">
            <a href="{{ url_for('modifier_film', id=film.id) }}" class="btn-icon" title="Modifier">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
            </a>
            <form method="POST" action="{{ url_for('supprimer_film', id=film.id) }}">
                <button type="submit" class="btn-icon btn-icon-danger" title="Supprimer" onclick="return confirm('Êtes-vous sûr de vouloir supprimer ce film ?')">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    </svg>
                </button>
            </form>
            <a href="{{ url_for('liste_films') }}" class="btn-link">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="19" y1="12" x2="5" y2="12"></line>
                    <polyline points="12 19 5 12 12 5"></polyline>
                </svg>
                Retour à la liste
            </a>
        </div>
    </div>
    
    <div class="commentaires-section">
        <h3>Commenter ce film</h3>
        <form method="POST" action="{{ url_for('commenter_film', id=film.id) }}" class="comment-form">
            <div>
                <label for="note">Note (0-10):</label>
                <input type="number" id="note" name="note" min="0" max="10" step="0.5" required>
            </div>
            <div>
                <label for="commentaire">Commentaire:</label>
                <textarea id="commentaire" name="commentaire" rows="4" placeholder="Votre avis sur ce film..."></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Publier</button>
        </form>
    </div>
    
    <div class="commentaires-list">
        <h3>Commentaires ({{ commentaires|length }})</h3>
        {% if commentaires %}
        <div class="commentaires">
            {% for commentaire in commentaires %}
            <div class="commentaire">
                <div class="commentaire-header">
                    <strong>{{ commentaire.username }}</strong>
                    <span class="note">{{ commentaire.note }}/10</span>
                    <span class="date">{{ commentaire.date[:10] }}</span>
                </div>
                {% if commentaire.commentaire %}
                <p class="commentaire-text">{{ commentaire.commentaire }}</p>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p>Aucun commentaire pour ce film.</p>
        {% endif %}
    </div>
</div>
{% endblock %}

